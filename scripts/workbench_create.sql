-- MySQL Script generated by MySQL Workbench
-- qua 29 mai 2019 15:10:03 -03
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema a_game_of_thrones
-- -----------------------------------------------------
DROP SCHEMA IF EXISTS `a_game_of_thrones` ;

-- -----------------------------------------------------
-- Schema a_game_of_thrones
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `a_game_of_thrones` DEFAULT CHARACTER SET utf8 ;
USE `a_game_of_thrones` ;

-- -----------------------------------------------------
-- Table `a_game_of_thrones`.`kingdoms`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `a_game_of_thrones`.`kingdoms` ;

CREATE TABLE IF NOT EXISTS `a_game_of_thrones`.`kingdoms` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(255) NOT NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `a_game_of_thrones`.`regions`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `a_game_of_thrones`.`regions` ;

CREATE TABLE IF NOT EXISTS `a_game_of_thrones`.`regions` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `kingdom_id` INT NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `climate` VARCHAR(255) NOT NULL,
  `stretch` INT NOT NULL,
  PRIMARY KEY (`id`),
  CONSTRAINT `fk_region_kingdom`
    FOREIGN KEY (`kingdom_id`)
    REFERENCES `a_game_of_thrones`.`kingdoms` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_region_kingdom_idx` ON `a_game_of_thrones`.`regions` (`kingdom_id` ASC);


-- -----------------------------------------------------
-- Table `a_game_of_thrones`.`people`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `a_game_of_thrones`.`people` ;

CREATE TABLE IF NOT EXISTS `a_game_of_thrones`.`people` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `mother_id` INT NULL,
  `father_id` INT NULL,
  `region_id` INT NULL,
  `name` VARCHAR(255) NOT NULL,
  `birth_date` DATE NULL,
  `death_date` DATE NULL,
  `gender` CHAR(1) NOT NULL,
  `is_alive` TINYINT(1) NOT NULL DEFAULT 1,
  `biography` LONGTEXT NULL,
  PRIMARY KEY (`id`),
  CONSTRAINT `fk_person_mother`
    FOREIGN KEY (`mother_id`)
    REFERENCES `a_game_of_thrones`.`people` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_person_father`
    FOREIGN KEY (`father_id`)
    REFERENCES `a_game_of_thrones`.`people` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_person_region`
    FOREIGN KEY (`region_id`)
    REFERENCES `a_game_of_thrones`.`regions` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_person_mother_idx` ON `a_game_of_thrones`.`people` (`mother_id` ASC);

CREATE INDEX `fk_person_father_idx` ON `a_game_of_thrones`.`people` (`father_id` ASC);

CREATE INDEX `fk_person_region_idx` ON `a_game_of_thrones`.`people` (`region_id` ASC);


-- -----------------------------------------------------
-- Table `a_game_of_thrones`.`houses`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `a_game_of_thrones`.`houses` ;

CREATE TABLE IF NOT EXISTS `a_game_of_thrones`.`houses` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(255) NOT NULL,
  `symbol` VARCHAR(255) NOT NULL,
  `colors` VARCHAR(255) NOT NULL,
  `words` VARCHAR(255) NOT NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `a_game_of_thrones`.`nobles`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `a_game_of_thrones`.`nobles` ;

CREATE TABLE IF NOT EXISTS `a_game_of_thrones`.`nobles` (
  `id` INT NULL DEFAULT NULL AUTO_INCREMENT,
  `person_id` INT NOT NULL,
  PRIMARY KEY (`id`),
  CONSTRAINT `fk_noble_person`
    FOREIGN KEY (`person_id`)
    REFERENCES `a_game_of_thrones`.`people` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_noble_person_idx` ON `a_game_of_thrones`.`nobles` (`person_id` ASC);


-- -----------------------------------------------------
-- Table `a_game_of_thrones`.`inheritances`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `a_game_of_thrones`.`inheritances` ;

CREATE TABLE IF NOT EXISTS `a_game_of_thrones`.`inheritances` (
  `noble_id` INT NOT NULL,
  `house_id` INT NOT NULL,
  CONSTRAINT `fk_inherits_noble`
    FOREIGN KEY (`noble_id`)
    REFERENCES `a_game_of_thrones`.`nobles` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_inherits_house`
    FOREIGN KEY (`house_id`)
    REFERENCES `a_game_of_thrones`.`houses` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_inherits_noble_idx` ON `a_game_of_thrones`.`inheritances` (`noble_id` ASC);

CREATE INDEX `fk_inherits_house_idx` ON `a_game_of_thrones`.`inheritances` (`house_id` ASC);

CREATE INDEX `composed` ON `a_game_of_thrones`.`inheritances` (`noble_id` ASC, `house_id` ASC);


-- -----------------------------------------------------
-- Table `a_game_of_thrones`.`lords`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `a_game_of_thrones`.`lords` ;

CREATE TABLE IF NOT EXISTS `a_game_of_thrones`.`lords` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `noble_id` INT NOT NULL,
  `heir_id` INT NULL,
  PRIMARY KEY (`id`),
  CONSTRAINT `fk_lord_heir`
    FOREIGN KEY (`heir_id`)
    REFERENCES `a_game_of_thrones`.`nobles` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_lord_noble`
    FOREIGN KEY (`noble_id`)
    REFERENCES `a_game_of_thrones`.`nobles` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_lord_heir_idx` ON `a_game_of_thrones`.`lords` (`heir_id` ASC);

CREATE INDEX `fk_lord_noble_idx` ON `a_game_of_thrones`.`lords` (`noble_id` ASC);


-- -----------------------------------------------------
-- Table `a_game_of_thrones`.`castles`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `a_game_of_thrones`.`castles` ;

CREATE TABLE IF NOT EXISTS `a_game_of_thrones`.`castles` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `region_id` INT NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `towers_number` INT NOT NULL DEFAULT 0,
  `halls_number` INT NOT NULL DEFAULT 0,
  PRIMARY KEY (`id`),
  CONSTRAINT `fk_castle_region`
    FOREIGN KEY (`region_id`)
    REFERENCES `a_game_of_thrones`.`regions` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_castle_region_idx` ON `a_game_of_thrones`.`castles` (`region_id` ASC);


-- -----------------------------------------------------
-- Table `a_game_of_thrones`.`knights`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `a_game_of_thrones`.`knights` ;

CREATE TABLE IF NOT EXISTS `a_game_of_thrones`.`knights` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `person_id` INT NOT NULL,
  `sworn_to` INT NULL,
  PRIMARY KEY (`id`),
  CONSTRAINT `fk_knight_person`
    FOREIGN KEY (`person_id`)
    REFERENCES `a_game_of_thrones`.`people` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_knight_sworn`
    FOREIGN KEY (`sworn_to`)
    REFERENCES `a_game_of_thrones`.`nobles` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_knight_person_idx` ON `a_game_of_thrones`.`knights` (`person_id` ASC);

CREATE INDEX `fk_knight_sworn_idx` ON `a_game_of_thrones`.`knights` (`sworn_to` ASC);


-- -----------------------------------------------------
-- Table `a_game_of_thrones`.`lords_castles`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `a_game_of_thrones`.`lords_castles` ;

CREATE TABLE IF NOT EXISTS `a_game_of_thrones`.`lords_castles` (
  `lord_id` INT NOT NULL,
  `castle_id` INT NOT NULL,
  `rule_begin_date` DATE NULL,
  `rule_end_date` DATE NULL,
  `is_current_ruler` TINYINT(1) NOT NULL DEFAULT 1,
  CONSTRAINT `fk_lords_castles_lord`
    FOREIGN KEY (`lord_id`)
    REFERENCES `a_game_of_thrones`.`lords` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_lords_castles_castle`
    FOREIGN KEY (`castle_id`)
    REFERENCES `a_game_of_thrones`.`castles` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `index1` ON `a_game_of_thrones`.`lords_castles` (`lord_id` ASC, `castle_id` ASC);

CREATE INDEX `fk_lords_castles_castle_idx` ON `a_game_of_thrones`.`lords_castles` (`castle_id` ASC);


-- -----------------------------------------------------
-- Table `a_game_of_thrones`.`kings`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `a_game_of_thrones`.`kings` ;

CREATE TABLE IF NOT EXISTS `a_game_of_thrones`.`kings` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `noble_id` INT NOT NULL,
  `heir_id` INT NULL,
  PRIMARY KEY (`id`),
  CONSTRAINT `fk_king_heir`
    FOREIGN KEY (`heir_id`)
    REFERENCES `a_game_of_thrones`.`nobles` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_king_noble`
    FOREIGN KEY (`noble_id`)
    REFERENCES `a_game_of_thrones`.`nobles` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_king_heir_idx` ON `a_game_of_thrones`.`kings` (`heir_id` ASC);

CREATE INDEX `fk_king_noble_idx` ON `a_game_of_thrones`.`kings` (`noble_id` ASC);


-- -----------------------------------------------------
-- Table `a_game_of_thrones`.`reigns`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `a_game_of_thrones`.`reigns` ;

CREATE TABLE IF NOT EXISTS `a_game_of_thrones`.`reigns` (
  `king_id` INT NOT NULL,
  `kingdom_id` INT NOT NULL,
  `rule_begin_date` DATE NULL,
  `rule_end_date` DATE NULL,
  `is_current_ruler` TINYINT(1) NOT NULL DEFAULT 1,
  CONSTRAINT `fk_reign_king`
    FOREIGN KEY (`king_id`)
    REFERENCES `a_game_of_thrones`.`kings` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_reign_kingdom`
    FOREIGN KEY (`kingdom_id`)
    REFERENCES `a_game_of_thrones`.`kingdoms` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `index1` ON `a_game_of_thrones`.`reigns` (`king_id` ASC, `kingdom_id` ASC);

CREATE INDEX `fk_reign_kingdom_idx` ON `a_game_of_thrones`.`reigns` (`kingdom_id` ASC);


-- -----------------------------------------------------
-- Table `a_game_of_thrones`.`great_lords`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `a_game_of_thrones`.`great_lords` ;

CREATE TABLE IF NOT EXISTS `a_game_of_thrones`.`great_lords` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `lord_id` INT NOT NULL,
  PRIMARY KEY (`id`),
  CONSTRAINT `fk_great_lord_lord`
    FOREIGN KEY (`lord_id`)
    REFERENCES `a_game_of_thrones`.`lords` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_great_lord_lord_idx` ON `a_game_of_thrones`.`great_lords` (`lord_id` ASC);


-- -----------------------------------------------------
-- Table `a_game_of_thrones`.`small_lords`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `a_game_of_thrones`.`small_lords` ;

CREATE TABLE IF NOT EXISTS `a_game_of_thrones`.`small_lords` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `lord_id` INT NOT NULL,
  `sovereign_id` INT NOT NULL,
  PRIMARY KEY (`id`),
  CONSTRAINT `fk_small_lord_lord`
    FOREIGN KEY (`lord_id`)
    REFERENCES `a_game_of_thrones`.`lords` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_small_lord_sovereign`
    FOREIGN KEY (`sovereign_id`)
    REFERENCES `a_game_of_thrones`.`great_lords` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_small_lord_lord_idx` ON `a_game_of_thrones`.`small_lords` (`lord_id` ASC);

CREATE INDEX `fk_small_lord_sovereign_idx` ON `a_game_of_thrones`.`small_lords` (`sovereign_id` ASC);


-- -----------------------------------------------------
-- Table `a_game_of_thrones`.`wardens`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `a_game_of_thrones`.`wardens` ;

CREATE TABLE IF NOT EXISTS `a_game_of_thrones`.`wardens` (
  `lord_id` INT NOT NULL,
  `region_id` INT NOT NULL,
  `rule_begin_date` DATE NULL,
  `rule_end_date` DATE NULL,
  `is_current_ruler` TINYINT(1) NOT NULL,
  CONSTRAINT `fk_wardens_lord`
    FOREIGN KEY (`lord_id`)
    REFERENCES `a_game_of_thrones`.`great_lords` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_wardens_region`
    FOREIGN KEY (`region_id`)
    REFERENCES `a_game_of_thrones`.`regions` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_wardens_region_idx` ON `a_game_of_thrones`.`wardens` (`region_id` ASC);

CREATE INDEX `fk_wardens_lord_idx` ON `a_game_of_thrones`.`wardens` (`lord_id` ASC);


-- -----------------------------------------------------
-- Table `a_game_of_thrones`.`marriages`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `a_game_of_thrones`.`marriages` ;

CREATE TABLE IF NOT EXISTS `a_game_of_thrones`.`marriages` (
  `husband_id` INT NOT NULL,
  `wife_id` INT NOT NULL,
  `still_married` TINYINT(1) NOT NULL DEFAULT 1,
  CONSTRAINT `fk_marriages_husband`
    FOREIGN KEY (`husband_id`)
    REFERENCES `a_game_of_thrones`.`people` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_marriages_wife`
    FOREIGN KEY (`wife_id`)
    REFERENCES `a_game_of_thrones`.`people` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_marriages_husband_idx` ON `a_game_of_thrones`.`marriages` (`husband_id` ASC);

CREATE INDEX `fk_marriages_wife_idx` ON `a_game_of_thrones`.`marriages` (`wife_id` ASC);


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
